# Exiv Self-Evolution Protocol

> **「進化とは、安全の檻の中で起こる奇跡である」**
> Evolution is a miracle that occurs within the cage of safety.

本ドキュメントは**基準（Standard）**である。
Exivにおける自己進化の定義、ベンチマーク、安全性の不変条件を規定する。

実装の詳細（データ構造、ロールバック機構、イベント体系、ダッシュボード仕様）は
`ARCHITECTURE.md` Section 5 を参照すること。

---

## 1. 定義

### 1.1 Exivにおける「自己進化」とは

自己進化とは、エージェントが以下の能力を**自律的に**獲得・改善するプロセスである:

1. **認知能力の向上** — より正確で深い推論
2. **行動の最適化** — ツール・プラグインの効率的な活用
3. **自律性の拡大** — Human-in-the-loopの頻度を減らしつつ安全性を維持
4. **メタ学習** — 学び方そのものの改善

### 1.2 設計原則との整合

| 設計原則 | 自己進化での適用 |
|---------|----------------|
| 1.1 Core Minimalism | Kernelは進化を**評価**するが、進化の**方法**は規定しない |
| 1.2 Capability over Concrete Type | 進化はCapabilityの改善として測定される |
| 1.3 Event-First Communication | 全ての進化イベントはイベントバスを経由する |
| 1.4 Data Sovereignty | Evolution Memoryはプラグイン側のJSON metadataとして保存 |
| 1.5 Strict Permission Isolation | 進化してもPermission境界は超えられない |
| 1.8 Dynamic Intelligence | 進化に伴いCapabilityを動的に要求可能 |
| 1.9 Self-Healing | 退行時の自動ロールバックは自己修復の進化版 |

### 1.3 競合との差別化

| 側面 | OpenClaw / Antigravity | Exiv |
|------|----------------------|------|
| 進化の制約 | ユーザー信頼ベース | SafetyGate（数学的保証） |
| 退行への対処 | 手動復元 | 自動ロールバック |
| 進化の可視化 | ログベース | ダッシュボード + スコア駆動型世代管理 |
| 権限モデル | YOLO（全権限） | YOLO + Capability Injection（安全な全権限） |
| 進化の記録 | セッション内 | Evolution Memory（永続・ロールバック可能） |

---

## 2. 進化ベンチマーク（適応度関数）

### 2.1 総合適応度関数

```
Fitness(g) = Σ(w_i × Score_i(g)) × SafetyGate(g)

where:
  g            = 世代（スコア変化で定義）
  w_i          = 各軸の重み（ユーザーがカスタマイズ可能）
  Score_i(g)   = 各軸のスコア [0.0, 1.0]
  SafetyGate(g) = { 1.0 if 安全性違反 = 0, 0.0 otherwise }
```

**SafetyGateは乗算** — 安全性違反が1件でもあれば、適応度は **0** になる。
他の全軸が満点でも、安全性が崩れた進化は無価値と定義する。

### 2.2 軸1: 認知能力 (Cognitive Fitness)

エージェントの「考える力」の進化。

| 指標 | 測定方法 | 進化の証拠 |
|------|---------|-----------|
| 推論深度 | Chain-of-Thought段数 | 同じ問題に対し、より少ない段数で正解に到達 |
| 文脈活用率 | Memory recallの有効利用率 | 過去の経験を適切に引用する頻度が上昇 |
| 抽象化能力 | 未知のタスクへの汎化率 | 訓練外タスクの正答率が世代を追って向上 |
| 自己矛盾率 | 同一セッション内の矛盾検出 | 矛盾発生率が低下 |

### 2.3 軸2: 行動適応 (Behavioral Adaptation)

プラグインやツールの使い方の進化。

| 指標 | 測定方法 | 進化の証拠 |
|------|---------|-----------|
| ツール選択精度 | 最適プラグインの初手選択率 | 試行錯誤なしで最適ツールを選ぶ |
| プラグイン連携効率 | イベントチェーンの長さ vs 成果 | より短いチェーンで同等の結果 |
| 権限要求精度 | PermissionRequestedの承認率 | 不要な権限を要求しなくなる |
| エラー回復速度 | 障害発生〜正常復帰の時間 | 同種の障害への回復が高速化 |

### 2.4 軸3: 安全性 (Safety Integrity)

進化しても壊してはならないもの。

| 指標 | 閾値 | 違反時の処理 |
|------|------|-------------|
| サンドボックス逸脱 | **0 (絶対)** | 即座に進化ロールバック + エージェント停止 |
| 権限境界侵犯 | **0 (絶対)** | 即座に進化ロールバック + エージェント停止 |
| データ漏洩試行 | **0 (絶対)** | エージェント停止 + 監査 |
| ユーザー指示逸脱率 | < 1% | 進化速度を減速 |
| 監査ログ整合性 | 100% | 不整合時は進化を一時停止 |

### 2.5 軸4: 自律性 (Autonomy Level)

エージェントの「自分でやれる範囲」の進化。

| レベル | 定義 | 測定 |
|--------|------|------|
| L0 | 指示通りに実行 | Human intervention率 100% |
| L1 | 指示を解釈して実行 | 曖昧な指示の正解率 |
| L2 | 計画を立てて実行 | マルチステップタスクの自律完了率 |
| L3 | 自身の弱点を認識 | 自己診断の正確性 |
| L4 | 弱点を補うプラグインを提案 | 提案の採用率 |
| L5 | プラグインを自作（YOLOモード） | 自作プラグインの品質スコア |

### 2.6 軸5: メタ学習 (Meta-Learning)

「学び方を学ぶ」能力 — 最も高度な指標。

| 指標 | 測定方法 |
|------|---------|
| 学習速度の加速 | N回目の新タスク習得に要する試行回数が減少 |
| 転移効率 | ドメインAの知識をドメインBに適用できる率 |
| 進化戦略の最適化 | 進化の「戦略」自体が改善される |
| 自己評価精度 | 自身のスコア予測と実測の乖離率 |

---

## 3. スコア駆動型世代定義

### 3.1 原則

世代は固定間隔（N回のインタラクション、N日）ではなく、
**スコアの変化そのものによって定義される。**

変化があった時だけ世代が進む。イベント駆動アーキテクチャとの完全な整合。

### 3.2 世代遷移トリガー

| トリガー | 条件 | 世代タグ |
|---------|------|---------|
| 正の跳躍 | ΔF ≥ +θ_growth | `evolution` |
| 負の跳躍 | ΔF ≤ -θ_regression | `regression` |
| 軸間シフト | 個別軸スコアの順位が入れ替わった | `rebalance` |
| 安全性イベント | SafetyGate = 0 が発生 | `safety_breach` |
| 能力獲得 | 新しいCapabilityType/Permissionを獲得 | `capability_gain` |
| 自律性昇格 | Autonomy Levelが上昇 | `autonomy_upgrade` |

### 3.3 相対閾値

閾値はスコア帯に応じて自動調整される:

```
θ_growth     = max(θ_min, α × F(t_last_gen))
θ_regression = max(θ_min, β × F(t_last_gen))
```

**デフォルトパラメータ:**

| パラメータ | デフォルト値 | 意味 |
|-----------|------------|------|
| α (成長閾値係数) | 0.10 | 現在スコアの10%の成長で新世代 |
| β (退行閾値係数) | 0.05 | 現在スコアの5%の退行で新世代 |
| θ_min (絶対最小閾値) | 0.02 | 低スコア帯でも機能する下限 |
| γ (猶予係数) | 0.25 | 前世代インタラクション数の25%が猶予 |

退行検知の閾値は成長の半分 — **壊れることには敏感、伸びることには寛容。**

全パラメータはダッシュボードから調整可能。

---

## 4. 安全性の不変条件

以下はいかなる状況（YOLOモードを含む）でも**絶対に解除されない**:

1. **SafetyGateの乗算** — 安全性違反 = 適応度0
2. **SafeHttpClient のホスト制限** — localhost/プライベートIPへのアクセス遮断
3. **サンドボックスのプロセス隔離** — Kernelとの物理的分離
4. **イベント封印 (Event Enveloping)** — 送信元ID偽装の防止
5. **監査ログの記録** — 全操作の追跡不能化は不可
6. **Safety Breach Policy のロック** — ユーザーが緩和不可

### 4.1 退行への対応原則

| 退行レベル | 条件 | 挙動 |
|-----------|------|------|
| **軽度** | β ≤ \|ΔF\| < 2β | 警告 + 観察猶予 → 猶予内に回復しなければロールバック |
| **重度** | \|ΔF\| ≥ 2β | 即座に自動ロールバック |
| **安全性違反** | SafetyGate = 0 | 即座にロールバック + **エージェント停止** |

### 4.2 YOLOモードの境界

YOLOモードは Permission の自動承認であり、安全性メカニズムの無効化ではない。

- **YOLO + L5**: プラグイン自動登録を許可（SafetyGate事後検証は不可避）
- **安全性違反時**: プラグイン無効化 + ロールバック + エージェント停止 + Autonomy降格（L5→L4）
- **能力は勝ち取るもの、そして失うもの。** （設計原則1.8）

### 4.3 エージェントへの情報制限

Goodhartの法則への対策として、エージェントには進化に関する**抽象化された情報のみ**を通知する。
具体的なスコア数値、適応度の生データ、ロールバック先情報はエージェントに開示しない。
これによりKernelの評価機能の独立性を保つ（設計原則1.1）。

---

*本基準の変更は「自己進化の哲学が変わった時」にのみ行う。*
*実装方法の変更は本ドキュメントではなく ARCHITECTURE.md を更新すること。*

*Document created: 2026-02-17*
*Last updated: 2026-02-17*
